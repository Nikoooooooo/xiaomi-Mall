<!DOCTYPE html>
<html>
	<head lang="en">
		<meta charset="utf-8" />
		<title>个人信息</title>
		<link rel="stylesheet" type="text/css" href="css/public.css"/>
		<link rel="stylesheet" type="text/css" href="css/mygrxx.css" />
	</head>
	<body>
		<!------------------------------head------------------------------>
		<div class="head ding">
			<div class="wrapper clearfix">
				<div class="clearfix" id="top">
					<h1 class="fl"><a href="index.html"><img src="images/logo-mi2.png" height="50px" width="60px" /></a></h1>
					<div class="fr clearfix" id="top1">
						<p class="fl">
							<a href="login.html" id="login">登录</a>
							<a href="register.html" id="reg">注册</a>
						</p>
						<form action="#" method="get" class="fl">
							<input type="text" placeholder="搜索" />
							<input type="button" />
						</form>
						<div class="btn fl clearfix">
							<a href="mygxin.html"><img src="img/grzx.png"/></a>
							<a href="#" class="er1"><img src="img/ewm.png"/></a>
							<a href="cart.html"><img src="img/gwc.png"/></a>
							<p><a href="#"><img src="img/smewm.png"/></a></p>
						</div>
					</div>
				</div>
				<ul class="clearfix" id="bott">
					<li><a href="index.html">首页</a></li>
					<li>
						<a href="#">所有商品</a>
						<div class="sList">
							<div class="wrapper  clearfix">
								<!-- 尚未更改-->
								<a href="search.html">
									<dl>
										<dt><img src="img/20230709164200.png"/></dt>
										<dd>华为</dd>
									</dl>
								</a>
								<a href="search.html">
									<dl>
										<dt><img src="img/20230710142351.png"/></dt>
										<dd>vivo</dd>
									</dl>
								</a>
								<a href="search.html">
									<dl>
										<dt><img src="img/20230710151444.png"/></dt>
										<dd>oppo</dd>
									</dl>
								</a>
								<a href="search.html">
									<dl>
										<dt><img src="img/20230710161145.png"/></dt>
										<dd>iPhone</dd>
									</dl>
								</a>
								<a href="search.html">
									<dl>
										<dt><img src="img/20230710162730.png" /></dt>
										<dd>小米</dd>
									</dl>
								</a>
							</div>
						</div>
					</li>
					<li>
						<a href="shopCart.html">购物车</a>
					</li>
				</ul>
			</div>
		</div>
		<!------------------------------idea------------------------------>
		<div class="address mt">
			<div class="wrapper clearfix">
				<a href="index.html" class="fl">首页</a>
				<span>/</span>
				<a href="mygxin.html" class="on">个人信息</a>
			</div>
		</div>

		<div id="app">
		<!------------------------------Bott------------------------------>
		<div class="Bott">
			<div class="wrapper clearfix">
				<div class="zuo fl">
					<h3>
						<a href="#"><img src="img/tx.png"/></a>
						<p class="clearfix"><span class="fl">{{userInfo.username}}</span></p>
					</h3>
					<div>
						<h4>我的交易</h4>
						<ul>
							<li><a href="shopCart.html">我的购物车</a></li>
							<li><a href="myorderq.html">我的订单</a></li>
						</ul>
						<h4>个人中心</h4>
						<ul>
							<li><a href="mygxin.html">我的中心</a></li>
							<li class="on"><a href="address.html">地址管理</a></li>
						</ul>
						<h4>账户管理</h4>
						<ul>
							<li><a href="mygrxx.html">个人信息</a></li>
							<li><a href="forgetPwd.html">修改密码</a></li>

						</ul>
					</div>
				</div>
				<div class="you fl">
					<h2>个人信息</h2>
					<div class="gxin">
						<div class="tx"><a href="#"><img src="img/tx.png"/><p id="avatar"></p></a></div>
						<div class="xx">
							<h3 class="clearfix"><strong class="fl">基础资料</strong><a href="#" class="fr" id="edit1">编辑</a></h3>
							<div>姓名：{{userInfo.username}}</div>
							<div>注册日期：{{userInfo.regDate}}</div>
							<div>电话号码：{{userInfo.tel}}</div>
							<div>邮箱：{{userInfo.email}}</div>
							<h3>高级设置</h3>
							<!--<div><span class="fl">银行卡</span><a href="#" class="fr">管理</a></div>-->
							<div><span class="fl">密码:*********</span><a href="#" class="fr" id="edit2">修改</a></div>
						</div>
					</div>			
				</div>
			</div>
		</div>
		<!--遮罩-->
		<div class="mask"></div>
		<!--编辑弹框-->
		<div class="bj">
			<div class="clearfix"><a href="#" class="fr gb"><img src="img/icon4.png"/></a></div>
			<h3>编辑基础资料</h3>
			<form action="#" method="get">
				<p><label>姓名：</label><input type="text"  v-model="username" /></p>
				<p><label>邮箱：</label><input type="text"  v-model="email"   /></p>
				<p><label>电话号码：</label><input type="text" v-model="tel"   /></p>
				<div class="bc">
					<input type="button" value="保存" @click="save"  />
					<input type="button" value="取消" />
				</div>
			</form>
		</div>
			<!--高级设置修改-->
			<div class="xg">
				<div class="clearfix"><a href="#" class="fr gb"><img src="img/icon4.png"/></a></div>
				<h3>修改密码</h3>
				<form action="#" method="get">
					<p><label>新密码：</label><input type="text" value="" v-model="pwd" /></p>
					<p><label>确定密码：</label><input type="text" value="" v-model="pwdCk" /></p>
					<div class="bc">
						<input type="button" value="保存" @click="save" />
						<input type="button" value="取消" />
					</div>
				</form>
			</div>

		</div>
		
		<!--返回顶部-->
		<div class="gotop">
			<a href="shopCart.html">
			<dl>
				<dt><img src="img/gt1.png"/></dt>
				<dd>去购<br />物车</dd>
			</dl>
			</a>
			<a href="#" class="dh">
			<dl>
				<dt><img src="img/gt2.png"/></dt>
				<dd>联系<br />客服</dd>
			</dl>
			</a>
			<a href="mygxin.html">
			<dl>
				<dt><img src="img/gt3.png"/></dt>
				<dd>个人<br />中心</dd>
			</dl>
			</a>
			<a href="#" class="toptop" style="display: none">
			<dl>
				<dt><img src="img/gt4.png"/></dt>
				<dd>返回<br />顶部</dd>
			</dl>
			</a>
			<p>400-800-8200</p>
		</div>
		<!--footer-->
		<div class="footer">
			<div class="top">
				<div class="wrapper">
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot1.png"/></a>
						<span class="fl">7天无理由退货</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot2.png"/></a>
						<span class="fl">15天免费换货</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot3.png"/></a>
						<span class="fl">满599包邮</span>
					</div>
					<div class="clearfix">
						<a href="#2" class="fl"><img src="img/foot4.png"/></a>
						<span class="fl">手机特色服务</span>
					</div>
				</div>
			</div>
			<p class="dibu">最家家居&copy;2013-2017公司版权所有 京ICP备080100-44备0000111000号<br />
			违法和不良信息举报电话：400-800-8200，本网站所列数据，除特殊说明，所有数据均出自我司实验室测试</p>
		</div>
		<script src="js/jquery-3.4.1.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/public.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/user.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/vue.js"></script>
		<script src="js/axios.js"></script>
		<script>
			//使用axios时,利用原型模式给axios加入 Authorization头,这样每个请求都会加入Authorization头部
			Vue.prototype.axios=axios;
			//在每次请求时,前段携带token到请求头中
			axios.interceptors.request.use(config=>{
				//从localStorage或Vuex中获取token
				const token=localStorage.getItem('token');
				//如果有token,就添加到请求头中
				if (token){
					config.headers.Authorization=token;
				}else {
					config.headers.Authorization='';
				}
				return config;
			},error=>{
				return Promise.reject(error);
			});

			var base_url="http://localhost:20001/xiaomi-security/";
			let app=new Vue({
				el:"#app",
				data:{
					loginStatus:0,
					userInfo:{},
					username:'',
					email:'',
					tel:'',
					pwd:'',
					pwdCk:'',

				},
				methods:{
					//检查登录
					checkLogin:function (){
						var _this=this;  //防止变量污染
						//如果浏览器的storage无token,则说明没有用户登录
						if (localStorage.getItem('token')==null){
							_this.userInfo={};
							_this.loginStatus=0;
							window.location="index.html";
						}
						axios.get('/xiaomi-security/user/loginCheck?pagenum=0&pagesize=0').then(data=>{
							if (data.data.code==0){
								_this.loginStatus=0;
								console.log(data.data);
							}else {
								_this.loginStatus=1;
								_this.userInfo=data.data.data;
							}
						});
					},
					//更新个人信息
					save:function (){
						const telRegex = /^1[0-9]{10}$/
						var params=new URLSearchParams();
						params.append("id",this.userInfo.id);
						params.append("username",this.username);
						params.append("email",this.email);
						params.append("tel",this.tel);
						params.append("pwd",this.pwdCk);
						//判断输入信息
						alert(this.username+' '+this.email+' '+this.tel+' '+this.pwd);
						if (this.username.length<2 || this.username.length>20){
							if (Object.keys(this.username).length === 0){

							}else {
								alert('用户名长度需在2~20个内');
								return ;
							}
						}
						if (!this.email.includes('@qq.com')){
							if (Object.keys(this.email).length === 0){

							}else {
								alert('邮箱格式不符合');
								return ;
							}
						}
						if (!telRegex.test(this.tel)){
							if (Object.keys(this.tel).length === 0){

							}else {
								alert('电话号码不符合要求');
								return ;
							}
						}
						if (this.pwd!=this.pwdCk){
							if (Object.keys(this.pwd).length === 0 && Object.keys(this.pwdCk).length === 0){

							}else {
								alert('密码不符合');
								return ;
							}
						}

						axios.post("/xiaomi-security/user/updateUser",params).then(data=>{
							if (data.code===0){
								alert('更新失败');
								return ;
							}
							alert('更新成功');
							window.location="mygrxx.html";
						})


					},
				},
				mounted:function (){
					//页面挂载
					axios.all([this.checkLogin()]).then(axios.spread(function (d1){

					}));
				}
			})
		</script>
	</body>
</html>
